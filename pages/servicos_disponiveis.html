<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viva Saúde - Serviços Disponíveis</title>
    <link rel="stylesheet" href="../style/nav_bar/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../style/servicos_disponiveis/section_servhistoria.css">
    <link rel="stylesheet" href="../style/servicos_disponiveis/search.css">
    

</head>

<body>

    <header>
        <nav>
            <div class="logo">
                <a href="../index.html"><img src="../assets/images/logo.png" alt="Logotipo"></a>
            </div>


            <button class="hamburger" id="hamburger-btn">
                <span></span>
                <span></span>
                <span></span>
            </button>

            <ul id="nav-menu">
                <li><a href="../index.html">Início</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle">Serviços</a>
                    <ul class="dropdown-menu hidden">
                        <li><a href="./atend_esp.html">Atendimento especializado</a></li>
                        <li><a href="./servicos_disponiveis.html">Serviços disponíveis</a></li>
                        <li><a href="./geoloc.html">Geolocalização</a></li>
                        <li><a href="./farm.html">Medicamentos</a></li>
                        <li><a href="./pag_de_inf.html">Página de Informações</a></li>
                    </ul>
                </li>
                <li><a href="#">Contato</a></li>
                <li><a href="#">Sobre nós</a></li>
            </ul>
        </nav>

    </header>

    <div class="atendimento">
        <img src="../assets/images/Medical care-pana 1 (1).png" alt="">
        <div class="box-atendimentoo">
            <h1>Entenda os serviços disponíveis no posto de saúde!</h1>
            <p>Acesse um guia simples com os principais atendimentos que você pode solicitar no posto mais próximo.</p>
            <div class="search-container">                <input type="text" id="search-input" placeholder="Digite o nome do seu bairro...">
                <button id="search-button">Encontrar unidades próximas</button>
            </div>
        </div>
    </div>

    <div id="search-results" class="search-results">
        <!-- Os resultados da busca aparecerão aqui -->
    </div>

    <div class="especialidades">
        <div class="cards">

            <div class="card">
                <div class="icon">
                    <img src="../assets/images/consultas.png" alt="Consultas Médicas">
                </div>
                <h3>Consultas Médicas</h3>
                <p>Quais especialidades e horários de funcionamento.</p>
            </div>

            <div class="card destaque">
                <div class="icon">
                    <img src="../assets/images/vacina.png" alt="Vacina">
                </div>
                <h3>Vacinação</h3>
                <p>Tipos de vacinas disponíveis, calendário e documentos necessários.</p>
            </div>

            <div class="card">
                <div class="icon">
                    <img src="../assets/images/prenatal.png" alt="Pré-natal">
                </div>
                <h3>Pré-natal</h3>
                <p>Como garantir o acompanhamento gestacional gratuito e seguro.</p>
            </div>

            <div class="card">
                <div class="icon">
                    <img src="../assets/images/saudemental.png" alt="Saúde Mental">
                </div>
                <h3>Saúde Mental</h3>
                <p>Apoio psicológico, social e grupos de atendimento.</p>
            </div>

            <div class="card">
                <div class="icon">
                    <img src="../assets/images/saudebucal.png" alt="Saúde Bucal">
                </div>
                <h3>Saúde Bucal</h3>
                <p>Serviços odontológicos e preventivos gratuitos.</p>
            </div>

            <div class="card">
                <div class="icon">
                    <img src="../assets/images/infantil.png" alt="Atendimento Infantil">
                </div>
                <h3>Atendimento Infantil</h3>
                <p>Vacinação, puericultura e suporte ao desenvolvimento.</p>
            </div>

        </div>

    </div>

    <script>
        const hamburgerBtn = document.getElementById("hamburger-btn");
        const navMenu = document.getElementById("nav-menu");
        const dropdownToggle = document.querySelector(".dropdown-toggle");
        const dropdownMenu = document.querySelector(".dropdown-menu");

        function isMobile() {
            return window.innerWidth <= 768;
        }

        // Toggle do menu hamburguer
        hamburgerBtn.addEventListener("click", () => {
            navMenu.classList.toggle("show");
            navMenu.classList.add("mobile");
        });

        // Toggle do submenu "Serviços" no mobile
        dropdownToggle.addEventListener("click", (e) => {
            if (isMobile()) {
                e.preventDefault();
                dropdownMenu.classList.toggle("show");
            }
        });

        function handleDropdownClick() {
            const dropdownMenu = document.querySelector(".dropdown-menu");
            dropdownMenu.classList.toggle("show");
        }

        // Aplica o clique até 1024px (tablet)
        if (window.innerWidth <= 1024) {
            const dropdownBtn = document.getElementById("servicos-btn");
            dropdownBtn.addEventListener("click", function (e) {
                e.preventDefault();
                handleDropdownClick();
            });
        }

        // Funcionalidade de busca
        let todasUnidades = [];

        async function carregarDados() {
            try {
                console.log('Carregando dados...');
                const response = await fetch('../data/unidades_saude_merged.json');
                if (!response.ok) {
                    throw new Error(`Erro ao carregar dados: ${response.status}`);
                }
                const data = await response.json();
                todasUnidades = data.features
                    .filter(feature => feature && feature.properties)
                    .map(feature => {
                        const props = feature.properties;
                        return {
                            nome: props.name || '',
                            bairro: (props.bairro || '').toUpperCase(),
                            tipo: props.type || '',
                            especialidade: props.especialidade || props.tipo_servico || '',
                            horario: props.horario || 'SEGUNDA A SEXTA 08:00 às 17:00',
                            endereco: props.address || '',
                            fone: props.fone || 'Não informado'
                        };
                    });
                console.log('Dados carregados:', todasUnidades.length, 'unidades');
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
            }
        }

        function formatarEspecialidades(especialidades) {
    if (!especialidades) return '';
    const listaEspecialidades = especialidades.split(',')
        .map(esp => esp.trim())
        .filter(esp => esp);
    
    if (listaEspecialidades.length === 0) return '';

    return `
        <div class="especialidades-disponiveis">
            <h4>Especialidades disponíveis:</h4>
            <ul>
                ${listaEspecialidades.map(esp => `<li>${esp}</li>`).join('')}
            </ul>
        </div>
    `;
}

function buscarServicos(termoBusca) {
    const searchResults = document.getElementById('search-results');
    termoBusca = termoBusca.toLowerCase().trim();
    
    console.log('Buscando por:', termoBusca);

    if (!termoBusca) {
        searchResults.innerHTML = '<p class="no-results">Digite o nome do seu bairro para encontrar unidades de saúde próximas.</p>';
        return;
    }

    // Filtra primeiro apenas unidades com bairro especificado
    const resultados = todasUnidades
        .filter(unidade => unidade.bairro) // Remove unidades sem bairro
        .filter(unidade => {
            const bairroMatch = unidade.bairro.toLowerCase().includes(termoBusca);
            const enderecoMatch = unidade.endereco && unidade.endereco.toLowerCase().includes(termoBusca);
            return bairroMatch || enderecoMatch;
        });

    console.log('Resultados encontrados:', resultados.length);

    if (resultados.length === 0) {
        searchResults.innerHTML = '<p class="no-results">Nenhuma unidade de saúde encontrada nesta localidade.</p>';
        return;
    }

    // Agrupamento por bairro
    const servicosPorBairro = {};
    resultados.forEach(unidade => {
        if (!servicosPorBairro[unidade.bairro]) {
            servicosPorBairro[unidade.bairro] = [];
        }
        servicosPorBairro[unidade.bairro].push(unidade);
    });

    let html = '';
    
    // Gera HTML para cada bairro
    for (const [bairro, unidades] of Object.entries(servicosPorBairro)) {
        html += `
            <div class="bairro-section">
                <h2>${bairro}</h2>
                <div class="servicos-list">
        `;

        // Agrupa unidades por tipo
        unidades.forEach(unidade => {
            html += `
                <div class="servico-item">
                    <h3>${unidade.tipo || 'Unidade de Saúde'}</h3>
                    <div class="unidade-info">
                        <p class="nome-unidade"><strong>${unidade.nome}</strong></p>
                        <p class="endereco"><i class="fas fa-map-marker-alt"></i> ${unidade.endereco}</p>
                        <p class="telefone"><i class="fas fa-phone"></i> ${unidade.fone || 'Telefone não informado'}</p>
                        <p class="horario"><i class="fas fa-clock"></i> ${unidade.horario || 'Horário não informado'}</p>
                        ${formatarEspecialidades(unidade.especialidade)}
                    </div>
                </div>
            `;
        });

        html += `
                </div>
            </div>
        `;
    }

    searchResults.innerHTML = html;
}

// Event listeners para a busca
document.addEventListener('DOMContentLoaded', () => {
    console.log('Inicializando...');
    carregarDados();
    
    const searchInput = document.getElementById('search-input');
    const searchButton = document.getElementById('search-button');

    searchButton.addEventListener('click', () => {
        buscarServicos(searchInput.value);
    });

    searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            buscarServicos(searchInput.value);
        }
    });
});
    </script>
</body>
</html>